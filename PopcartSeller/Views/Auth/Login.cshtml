
<div class="d-flex flex-column h-100 p-5">
    <div class="d-flex flex-column flex-grow-1">
        <div class="row h-100">
            <div class="col-xxl-7">
                <div class="row justify-content-center h-100">
                    <div class="col-lg-6 py-lg-5">
                        <div class="d-flex flex-column h-80 justify-content-center">
                            <div class="auth-logo mb-4">
                                <a href="#" class="logo-dark">
                                    <img src="~/assets/images/logo-dark.png" height="60" alt="logo dark">
                                </a>
                                <a href="#" class="logo-light">
                                    <img src="~/assets/images/logo-light.png" height="60" alt="logo light">
                                </a>
                            </div>

                           <!-- Mobile Number Section -->
                            <div id="Mobile">
                                <h2 class="fw-bold fs-24">Sign In</h2>
                                <p class="text-muted mt-1 mb-4">Enter your mobile number to access your dashboard</p>

                                <div class="mb-5">
                                    <form id="sendOtpForm" method="post" class="authentication-form">
                                        <div class="mb-3">
                                            <label class="form-label" for="phoneNumber">Mobile Number</label>
                                            <div class="input-group">
                                                <select id="countryCode" name="countryCode" class="form-select" style="max-width:120px;appearance:none!important;" required>
                                                    <option value="+234" data-country="Nigeria">ðŸ‡³ðŸ‡¬ +234 </option>
                                                    <option value="+213" data-country="Algeria">ðŸ‡©ðŸ‡¿ +213 </option>
                                                    <option value="+244" data-country="Angola">ðŸ‡¦ðŸ‡´ +244 </option>
                                                    <option value="+229" data-country="Benin">ðŸ‡§ðŸ‡¯ +229 </option>
                                                    <option value="+267" data-country="Botswana">ðŸ‡§ðŸ‡¼ +267 </option>
                                                    <option value="+226" data-country="Burkina Faso">ðŸ‡§ðŸ‡« +226 </option>
                                                    <option value="+257" data-country="Burundi">ðŸ‡§ðŸ‡® +257 </option>
                                                    <option value="+237" data-country="Cameroon">ðŸ‡¨ðŸ‡² +237 </option>
                                                    <option value="+238" data-country="Cape Verde">ðŸ‡¨ðŸ‡» +238 </option>
                                                    <option value="+236" data-country="Central African Republic">ðŸ‡¨ðŸ‡« +236 </option>
                                                    <option value="+235" data-country="Chad">ðŸ‡¹ðŸ‡© +235 </option>
                                                    <option value="+269" data-country="Comoros">ðŸ‡°ðŸ‡² +269 </option>
                                                    <option value="+242" data-country="Congo">ðŸ‡¨ðŸ‡¬ +242 </option>
                                                    <option value="+243" data-country="Democratic Republic of the Congo">ðŸ‡¨ðŸ‡© +243 </option>
                                                    <option value="+225" data-country="CÃ´te d'Ivoire">ðŸ‡¨ðŸ‡® +225</option>
                                                    <option value="+253" data-country="Djibouti">ðŸ‡©ðŸ‡¯ +253 </option>
                                                    <option value="+20" data-country="Egypt">ðŸ‡ªðŸ‡¬ +20 </option>
                                                    <option value="+240" data-country="Equatorial Guinea">ðŸ‡¬ðŸ‡¶ +240 </option>
                                                    <option value="+291" data-country="Eritrea">ðŸ‡ªðŸ‡· +291 </option>
                                                    <option value="+251" data-country="Ethiopia">ðŸ‡ªðŸ‡¹ +251 </option>
                                                    <option value="+241" data-country="Gabon">ðŸ‡¬ðŸ‡¦ +241 </option>
                                                    <option value="+220" data-country="Gambia">ðŸ‡¬ðŸ‡² +220 </option>
                                                    <option value="+233" data-country="Ghana">ðŸ‡¬ðŸ‡­ +233 </option>
                                                    <option value="+224" data-country="Guinea">ðŸ‡¬ðŸ‡³ +224 </option>
                                                    <option value="+245" data-country="Guinea-Bissau">ðŸ‡¬ðŸ‡¼ +245 </option>
                                                    <option value="+254" data-country="Kenya">ðŸ‡°ðŸ‡ª +254 </option>
                                                    <option value="+266" data-country="Lesotho">ðŸ‡±ðŸ‡¸ +266 </option>
                                                    <option value="+231" data-country="Liberia">ðŸ‡±ðŸ‡· +231 </option>
                                                    <option value="+218" data-country="Libya">ðŸ‡±ðŸ‡¾ +218 </option>
                                                    <option value="+261" data-country="Madagascar">ðŸ‡²ðŸ‡¬ +261 </option>
                                                    <option value="+265" data-country="Malawi">ðŸ‡²ðŸ‡¼ +265 </option>
                                                    <option value="+223" data-country="Mali">ðŸ‡²ðŸ‡± +223 </option>
                                                    <option value="+222" data-country="Mauritania">ðŸ‡²ðŸ‡· +222 </option>
                                                    <option value="+230" data-country="Mauritius">ðŸ‡²ðŸ‡º +230 </option>
                                                    <option value="+212" data-country="Morocco">ðŸ‡²ðŸ‡¦ +212 </option>
                                                    <option value="+258" data-country="Mozambique">ðŸ‡²ðŸ‡¿ +258 </option>
                                                    <option value="+264" data-country="Namibia">ðŸ‡³ðŸ‡¦ +264 </option>
                                                    <option value="+227" data-country="Niger">ðŸ‡³ðŸ‡ª +227 </option>
                                                    <option value="+234" data-country="Nigeria">ðŸ‡³ðŸ‡¬ +234 </option>
                                                    <option value="+250" data-country="Rwanda">ðŸ‡·ðŸ‡¼ +250 </option>
                                                    <option value="+290" data-country="Saint Helena">ðŸ‡¸ðŸ‡­ +290 </option>
                                                    <option value="+239" data-country="Sao Tome and Principe">ðŸ‡¸ðŸ‡¹ +239 </option>
                                                    <option value="+221" data-country="Senegal">ðŸ‡¸ðŸ‡³ +221 </option>
                                                    <option value="+248" data-country="Seychelles">ðŸ‡¸ðŸ‡¨ +248 </option>
                                                    <option value="+232" data-country="Sierra Leone">ðŸ‡¸ðŸ‡± +232 </option>
                                                    <option value="+252" data-country="Somalia">ðŸ‡¸ðŸ‡´ +252 </option>
                                                    <option value="+27" data-country="South Africa">ðŸ‡¿ðŸ‡¦ +27 </option>
                                                    <option value="+211" data-country="South Sudan">ðŸ‡¸ðŸ‡¸ +211 </option>
                                                    <option value="+249" data-country="Sudan">ðŸ‡¸ðŸ‡© +249 </option>
                                                    <option value="+268" data-country="Eswatini">ðŸ‡¸ðŸ‡¿ +268 </option>
                                                    <option value="+255" data-country="Tanzania">ðŸ‡¹ðŸ‡¿ +255 </option>
                                                    <option value="+228" data-country="Togo">ðŸ‡¹ðŸ‡¬ +228 </option>
                                                    <option value="+216" data-country="Tunisia">ðŸ‡¹ðŸ‡³ +216 </option>
                                                    <option value="+256" data-country="Uganda">ðŸ‡ºðŸ‡¬ +256 </option>
                                                    <option value="+260" data-country="Zambia">ðŸ‡¿ðŸ‡² +260 </option>
                                                    <option value="+263" data-country="Zimbabwe">ðŸ‡¿ðŸ‡¼ +263 </option>
                                                </select>


                                                <!-- Remaining Mobile Number Input -->
                                                <input type="tel" id="phoneNumber" name="phoneNumber" class="form-control" placeholder="XXXXXXXXXX" pattern="\d{10}" title="Enter the 10-digit phone number" required>
                                            </div>
                                        </div>

                                        <div class="mb-1 text-center d-grid">
                                            <button class="btn btn-soft-primary" type="submit" onclick="submitForm(event)">Send OTP</button>
                                        </div>
                                    </form>
                                </div>
                            </div>


                            

                            <!-- OTP Verification Section -->
                           <div id="OtpVerify" style="display: none;">
                              <h3 class="fw-bold fs-20 text-center mt-5">Enter OTP</h3>
                              <p class="text-muted text-center mb-4">We sent a 5-digit code to your phone</p>

                              <form asp-controller="Auth" asp-action="VerifyPhone" method="post" class="authentication-form">
                                <div class="d-flex justify-content-center gap-2 mb-3">
                                    <input type="tel" id="phone" style="display: none;" name="phone" class="form-control">
                                    
                                    <!-- 4 OTP Input Boxes -->
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <input type="text" id="otp-@i" name="otp" maxlength="1" class="otp-input text-center form-control"
                                            style="width: 50px; height: 50px; font-size: 24px;" required 
                                            oninput="moveToNextBox(event, this)" />
                                    }
                                </div>

                                <!-- Hidden field to store the combined code -->
                                <input type="hidden" id="code" name="code">

                                <div class="mb-1 text-center d-grid">
                                    <button class="btn btn-soft-primary" type="submit" onclick="combineOtpCode(event)">Verify OTP</button>
                                </div>
                            </form>

                              <br>
                              <div class="mb-3 text-center">
                                   <a href="#" id="resendOtpLink" class="text-muted text-unline-dashed ms-1" onclick="resendOtp(event)" style="pointer-events: none; color: #adb5bd;">Resend OTP</a>
                                   <span id="countdownTimer" style="display: none; color: #6c757d; margin-left: 10px;"></span>
                              </div>
                              </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xxl-5 d-none d-xxl-flex">
                <div class="card h-100 mb-0 overflow-hidden">
                    <div class="d-flex flex-column h-100">
                        <img src="~/assets/images/small/img-10.jpg" alt="" class="w-100 h-100">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const phone = document.getElementById('phone');

      function moveToNextBox(event, currentInput) {
        if (currentInput.value.length === 1) {
            const nextInput = currentInput.nextElementSibling;
            if (nextInput) {
                nextInput.focus();
            }
        }
    }
    function combineOtpCode(event) {
        event.preventDefault(); 

        let otpCode = '';
        for (let i = 1; i <= 5; i++) {
            otpCode += document.getElementById(`otp-${i}`).value;
        }

        document.getElementById('code').value = otpCode;

        event.target.closest('form').submit();
    }

    let countdownInterval;

    function startCountdown(duration) {
        const countdownElement = document.getElementById('countdownTimer');
        const resendLink = document.getElementById('resendOtpLink');
        let timeRemaining = duration;

        resendLink.style.pointerEvents = 'none'; 
        resendLink.style.color = '#adb5bd'; 
        countdownElement.style.display = 'inline'; 

        countdownInterval = setInterval(() => {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            countdownElement.textContent = `(${minutes}:${seconds < 10 ? '0' + seconds : seconds})`;

            if (timeRemaining === 0) {
                clearInterval(countdownInterval);
                countdownElement.style.display = 'none'; 
                resendLink.style.pointerEvents = 'auto';
                resendLink.style.color = ''; 
            }

            timeRemaining--;
        }, 1000);
    }

    async function submitForm(event) {
    event.preventDefault(); 

    const form = document.getElementById('sendOtpForm');
    const phoneNumberInput = document.getElementById('phoneNumber').value;
    const countryCode = document.getElementById('countryCode').value;

    
    const fullPhoneNumber = `${countryCode}${phoneNumberInput}`;

    try {
        const response = await fetch(
            'https://api-ms-td09.onrender.com/auth/send-otp',
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    phone: fullPhoneNumber,
                }),
            }
        );

        const responseData = await response.json();

        if (response.ok && responseData.status) {
            phone.value = fullPhoneNumber;
           
            const mobileSection = document.getElementById('Mobile');
            const otpSection = document.getElementById('OtpVerify');

            mobileSection.style.display = 'none'; 
            otpSection.style.display = 'block'; 

            startCountdown(60); 
        } else {
            alert(responseData.message || 'Failed to send OTP. Please try again.');
        }
    } catch (error) {
        console.error('Error sending OTP:', error);
        alert('An error occurred while sending the OTP. Please try again.');
    }
}

    function resendOtp(event) {
        event.preventDefault();
        startCountdown(60); 
    }
</script>

<style>
    .otp-input {
        border: 1px solid #ddd;
        text-align: center;
        font-weight: lighter;
    }
</style>
